# UI 挙動

## ズーム

`src/App.vue` ではズームを 4 モードで切り替えます（状態機械）。

- `全期間 (FULL)`
  - 全イベントの最小〜最大に合わせてスケール
- `年ズーム (YEAR)`
  - スライダーで中心年（`centerYear`）を移動
  - 表示範囲は中心年 ±1年（固定）
- `月ズーム (MONTH)`
  - スライダーで中心年月（`centerMonth`）を移動
  - 表示範囲は中心月 ±`zoomRangeMonths`（現在は 1 ヶ月）
- `日ズーム (DAY)`
  - スライダーで中心日（`centerDay`）を移動
  - 表示範囲は中心日 ±`zoomRangeDays`（現在は 1 日）

補足:
- `YEAR` に切り替えたとき、選択中イベントがあればそのイベントの `year` を中心にします
- `MONTH` に切り替えたとき、選択中イベントがあればそのイベントの `startTime` を中心にします
- `DAY` に切り替えたとき、選択中イベントがあればそのイベントの `startTimeDay` を中心にします

## ズーム操作 UI

- ズーム段階は「全期間 → 年表示 → 月表示 → 日表示」を `＋` で進めます
- `−` は逆方向に戻します
- ズーム切り替えはボタン式ではなく固定の `＋ / −` 操作です
- 年・月・日スライダーの左右に `< / >` ボタンがあり、1単位ずつ移動できます
- `< / >` ボタンは長押しで連続移動します

## キーボード操作

- `→` / `←`
  - 日ズーム: ±1日
  - 月ズーム: ±1か月
  - 年ズーム: ±1年
- `Shift + → / ←`: 常に年単位で移動

## スワイプ操作

- SVG 上で左右スワイプすると年・月・日を 1 単位移動します
- 縦方向のスワイプは無視されます

## 月/日ズーム時の補助日表示

- 月/日ズーム時のみ、日付（1〜31）を薄いテキストで補助表示します
- 実暦は考慮せず、1か月=31日として扱います
- 月名（◯月）ラベルは 1 日目位置の上部に表示されます

## イベントの選択

- イベント（期間バー領域）をクリックすると、そのイベントが選択状態になります
- 右側の固定パネル（`aside.side-panel`）が開き、タイトル/期間/詳細が表示されます（期間は年・月・日）
- マウスオーバー時のツールチップは `title` と `detail` を表示します

## 期間内の単日イベント

- `occurrenceType: "singleWithinRange"` のイベントは「期間内のどこか1日」で発生することを示します
- タイムライン上ではバーが破線になり、中央に小さな点が表示されます

## 開始点・終了点マーカー

- 期間バーの開始点と終了点に丸マーカーを表示します
- 開始点・終了点ともにキャラクターの色で表示されます

## 描画フィールド

- タイムライン描画領域は矩形で囲われます
- イベントや目盛りは clipPath により領域外へ描画されません

## URL 同期

選択状態は URL クエリに反映されます。

- 選択: `?event=<eventId>` を付与
- 閉じる: `event` クエリを削除

実装は `history.replaceState` のため、ページ遷移せず URL だけ更新されます。

## 初回ロード時の復元

初回マウント時に URL クエリの `event` を読み、該当 `id` のイベントが存在すれば自動的に選択します。

## キーボード

- `Escape`: パネルを閉じる

## 表示ラベル

年表示は `yearLabel(year)` が変換します。

- `1` → `1年目`
- `2` 以上 → `n年目`
- `0` 以下 → `n年前`（`1 - year` を `n` として扱う）

## ヘッダーとサイドメニュー

- 上部に固定ヘッダーを表示し、左のアイコンからメニューを開きます
- メニューはオーバーレイ/スライド式で開閉し、背景クリックや `Escape` で閉じます
- カテゴリ選択後、該当レーンをチェックボックスで表示/非表示にできます
- 初期状態ではレーンは全てオフです
- 「一括」チェックでカテゴリ内の全レーンをまとめて選択/解除できます

## レーンラベルの配色

- 文字色はデータの `color` を使用します
- 背景色は OKLCH で色相反転＋高明度/低彩度に調整し、必要に応じてコントラストを確保します
